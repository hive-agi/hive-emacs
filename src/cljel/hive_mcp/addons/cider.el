;;; hive-mcp-cider.el --- -*- lexical-binding: t; -*-
;; Generated by ClojureElisp

(require 'clojure-elisp-runtime)
(require 'hive-mcp-api)

;;; Code:



(declare-function cider-current-ns "cider-client")

(declare-function cider-current-connection "cider-client")

(declare-function cider-nrepl-eval-sync "cider-nrepl")

(declare-function cider-last-sexp "cider-eval")

(declare-function cider-interactive-eval "cider-eval")

(declare-function cider-connect-clj "cider")

(declare-function cider-connected-p "cider-connection")

(declare-function cider-repl-buffers "cider-connection")

(defgroup hive-mcp-cider nil
  "Integration between CIDER and hive-mcp."
  :group 'cider
  :prefix "hive-mcp-cider-")

(defcustom hive-mcp-cider-auto-log-results nil
  "When non-nil, automatically log REPL results to memory."
  :group 'hive-mcp-cider
  :type 'boolean)

(defcustom hive-mcp-cider-log-threshold 100
  "Minimum result length to auto-log (avoids logging trivial results)."
  :group 'hive-mcp-cider
  :type 'integer)

(defcustom hive-mcp-cider-auto-start-nrepl nil
  "When non-nil, automatically start nREPL server on addon load.\nThe server starts asynchronously and does not block Emacs startup."
  :group 'hive-mcp-cider
  :type 'boolean)

(defcustom hive-mcp-cider-auto-connect t
  "When non-nil, automatically connect CIDER when nREPL is available.\nWorks with both auto-started and externally started nREPL servers."
  :group 'hive-mcp-cider
  :type 'boolean)

(defcustom hive-mcp-cider-nrepl-port 7910
  "Default port for nREPL server."
  :group 'hive-mcp-cider
  :type 'integer)

(defcustom hive-mcp-cider-project-dir nil
  "Project directory for starting nREPL.\nIf nil, uses the current project root or `default-directory'."
  :group 'hive-mcp-cider
  :type '(choice (const nil) directory))

(defcustom hive-mcp-cider-connect-retry-interval 1.0
  "Seconds between connection retry attempts."
  :group 'hive-mcp-cider
  :type 'number)

(defcustom hive-mcp-cider-connect-max-retries 30
  "Maximum number of connection retry attempts (0 = unlimited)."
  :group 'hive-mcp-cider
  :type 'integer)

(defcustom hive-mcp-cider-eval-timeout 60
  "Timeout in seconds for nREPL evaluation with heartbeat polling.\nDefault is 60 seconds. The evaluation uses async request with polling\ninstead of blocking sync request."
  :group 'hive-mcp-cider
  :type 'integer)

(defcustom hive-mcp-cider-poll-interval 0.1
  "Interval in seconds between heartbeat polls during async eval.\nSmaller values = more responsive, larger values = less CPU overhead."
  :group 'hive-mcp-cider
  :type 'number)

(defvar hive-mcp-cider--last-eval nil)

(defvar hive-mcp-cider--async-result nil)

(defvar hive-mcp-cider--async-done nil)

(defvar hive-mcp-cider--async-error nil)

(defvar hive-mcp-cider--nrepl-process nil)

(defvar hive-mcp-cider--connect-timer nil)

(defvar hive-mcp-cider--connect-attempts 0
  "Number of connection attempts made.")

(defvar hive-mcp-cider--sessions (make-hash-table :test 'equal)
  "Registry of named CIDER sessions.\nKeys are session names (strings).\nValues are plists with :port, :process, :buffer, :agent-id, :project-dir.")

(defcustom hive-mcp-cider-session-port-base 7920
  "Base port for spawning new CIDER sessions.\nSessions will use ports starting from this value."
  :group 'hive-mcp-cider
  :type 'integer)

(defcustom hive-mcp-cider-session-port-max 7999
  "Maximum port for CIDER sessions."
  :group 'hive-mcp-cider
  :type 'integer)

(provide 'hive-mcp-cider)
;;; hive-mcp-cider.el ends here
