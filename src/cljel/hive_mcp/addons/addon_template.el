;;; hive-mcp-template.el --- -*- lexical-binding: t; -*-
;; Generated by ClojureElisp

(require 'clojure-elisp-runtime)
(require 'hive-mcp-api)

;;; Code:



(declare-function target-package-function "target-package")

(defgroup hive-mcp-template nil
  "Integration between hive-mcp and target-package."
  :group 'hive-mcp
  :prefix "hive-mcp-template-")

(defcustom hive-mcp-template-auto-context nil
  "When non-nil, automatically include MCP context."
  :group 'hive-mcp-template
  :type 'boolean)

(defvar hive-mcp-template--initialized nil)

(defun hive-mcp-template---ensure-api ()
  "Ensure hive-mcp-api is available."
  (unless (featurep 'hive-mcp-api)
    (require 'hive-mcp-api nil t))
  (featurep 'hive-mcp-api))

(defun hive-mcp-template-get-context ()
  "Get MCP context formatted for target-package."
  (when (-ensure-api)
    (hive-mcp-api-get-context)))

(defun hive-mcp-template-save-to-memory (content type &optional tags)
  "Save CONTENT to hive-mcp memory as TYPE with optional TAGS."
  (interactive (list (if (use-region-p) (buffer-substring-no-properties (region-beginning) (region-end)) (clel-read-string "Content: ")) (completing-read "Type: " '("note" "snippet" "decision") nil t) (split-string (clel-read-string "Tags (comma-separated): ") "," t " ")))
  (when (-ensure-api)
    (hive-mcp-api-memory-add type content tags)
    (message "Saved to memory as %s" type)))

(defun hive-mcp-template-query-memory (type &optional limit)
  "Query hive-mcp memory for entries of TYPE, return up to LIMIT entries."
  (when (-ensure-api)
    (hive-mcp-api-memory-query type nil (or limit 10))))

(define-minor-mode hive-mcp-template-mode
  "Minor mode for hive-mcp integration with target-package."
  :init-value nil
  :lighter " MCP-T"
  :global t
  :group 'hive-mcp-template
  (if hive-mcp-template-mode (progn
  (setq hive-mcp-template--initialized t)
  (message "hive-mcp-template enabled")) (message "hive-mcp-template disabled")))

(defun hive-mcp-template---addon-init ()
  "Synchronous init - runs immediately after loading.\nUse for lightweight setup that must complete before use."
  (require 'hive-mcp-api nil t)
  (message "hive-mcp-template: initialized"))

(defun hive-mcp-template---addon-async-init ()
  "Asynchronous init - runs in background after loading.\nUse for long-running startup (servers, subprocesses).\nShould return a process object if starting a subprocess."
  nil)

(defun hive-mcp-template---addon-shutdown ()
  "Shutdown - runs when addon is unloaded.\nUse for cleanup (stopping servers, saving state)."
  (message "hive-mcp-template: shutdown complete"))

(with-eval-after-load 'hive-mcp-addons
  (hive-mcp-addon-register 'addon-template :version "0.1.0" :description "Template addon for hive-mcp" :requires '(hive-mcp-api) :provides '(hive-mcp-template-mode) :init #'-addon-init :async-init #'-addon-async-init :shutdown #'-addon-shutdown))

(provide 'hive-mcp-template)
;;; hive-mcp-template.el ends here
