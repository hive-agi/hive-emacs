;;; hive-mcp.el --- -*- lexical-binding: t; -*-
;; Generated by ClojureElisp

(require 'clojure-elisp-runtime)

;;; Code:



(require 'json)

(require 'project)

(defgroup hive-mcp nil
  "Emacs integration for Claude MCP."
  :group 'tools
  :prefix "hive-mcp-")

(defcustom hive-mcp-auto-initialize t
  "Automatically initialize hive-mcp on mode enable."
  :group 'hive-mcp
  :type 'boolean)

(defcustom hive-mcp-load-builtin-workflows t
  "Load built-in example workflows on initialization."
  :group 'hive-mcp
  :type 'boolean)

(defcustom hive-mcp-auto-enable nil
  "Automatically enable `hive-mcp-mode' when Emacs starts.\nSet this to t in your config to have hive-mcp ready on startup."
  :group 'hive-mcp
  :type 'boolean)

(defcustom hive-mcp-setup-addons t
  "Set up addon system during initialization.\nWhen non-nil, loads addons from `hive-mcp-addon-always-load'\nand enables auto-loading for feature-triggered addons."
  :group 'hive-mcp
  :type 'boolean)

(require 'hive-mcp-memory)

(require 'hive-mcp-kanban)

(require 'hive-mcp-context)

(require 'hive-mcp-triggers)

(require 'hive-mcp-workflows)

(require 'hive-mcp-api)

(require 'hive-mcp-addons)

(require 'hive-mcp-channel)

(require 'hive-mcp-hivemind)

(declare-function hive-mcp-addons-setup "hive-mcp-addons")

(when (require 'transient nil t)
    (require 'hive-mcp-transient))

(defvar hive-mcp--initialized nil)

(defun hive-mcp-initialize ()
  "Initialize hive-mcp system.\nRe-entrant safe: only runs once unless reset via `hive-mcp-reset'."
  (interactive)
  (unless hive-mcp--initialized
    (hive-mcp-memory-init)
    (hive-mcp-workflow--load)
    (when hive-mcp-load-builtin-workflows
    (hive-mcp-workflow--register-builtins))
    (hive-mcp-setup-keybindings)
    (hive-mcp-setup-hooks)
    (when hive-mcp-setup-addons
    (hive-mcp-addons-setup))
    (when (fboundp 'hive-mcp-channel-setup-auto-connect)
    (hive-mcp-channel-setup-auto-connect))
    (setq hive-mcp--initialized t)
    (message "Emacs-mcp initialized (C-c m for menu)")))

(defun hive-mcp-reset ()
  "Reset hive-mcp state (for debugging).\nClears all caches and registries so `hive-mcp-initialize' can run again."
  (interactive)
  (setq hive-mcp--initialized nil)
  (clrhash hive-mcp-memory--cache)
  (clrhash hive-mcp-workflow-registry)
  (clrhash hive-mcp-trigger-registry)
  (message "Emacs-mcp reset"))

(define-minor-mode hive-mcp-mode
  "Minor mode for hive-mcp integration with Claude.\n\nProvides persistent memory, context gathering, workflows, and\nkeybindings for AI-assisted development.\n\n\\{hive-mcp-command-map}"
  :global t
  :lighter " MCP"
  :keymap (let [map (make-sparse-keymap)] (when hive-mcp-keymap-prefix (define-key map hive-mcp-keymap-prefix hive-mcp-command-map)) map)
  (if hive-mcp-mode (when hive-mcp-auto-initialize
    (hive-mcp-initialize)) (message "Emacs-mcp mode disabled")))

(defalias 'hive-mcp-note #'hive-mcp-add-note-interactive "Add a note to project memory.")

(defalias 'hive-mcp-snippet #'hive-mcp-add-snippet-interactive "Save region as a snippet.")

(defalias 'hive-mcp-context #'hive-mcp-show-context "Show current context.")

(defalias 'hive-mcp-memory #'hive-mcp-show-memory "Show project memory.")

(defalias 'hive-mcp-workflow #'hive-mcp-workflow-run-interactive "Run a workflow.")

(defun hive-mcp---maybe-auto-enable ()
  "Maybe enable `hive-mcp-mode' automatically.\nControlled by `hive-mcp-auto-enable'.\nTo use, add to your init file:\n  (setq hive-mcp-auto-enable t)\n  (add-hook 'after-init-hook #'hive-mcp--maybe-auto-enable)"
  (when hive-mcp-auto-enable
    (hive-mcp-mode 1)))

(provide 'hive-mcp)

(provide 'hive-mcp)
;;; hive-mcp.el ends here
