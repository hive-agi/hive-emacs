;;; claude-code-ide-debug.el --- -*- lexical-binding: t; -*-
;; Generated by ClojureElisp

(require 'clojure-elisp-runtime)
(require 'json)
(require 'project)

;;; Code:



(defcustom claude-code-ide-debug nil
  "When non-nil, enable debug logging for Claude Code IDE."
  :group 'claude-code-ide
  :type 'boolean)

(defcustom claude-code-ide-log-with-context t
  "When non-nil, include session context in log messages."
  :group 'claude-code-ide
  :type 'boolean)

(defcustom claude-code-ide-debug-buffer "*claude-code-ide-debug*"
  "Buffer name for debug output."
  :group 'claude-code-ide
  :type 'string)

(defun claude-code-ide-debug---get-session-context ()
  "Get current session context for logging."
  (if claude-code-ide-log-with-context (format "[%s]" (or (ignore-errors (file-name-nondirectory (directory-file-name (project-root (project-current))))) "no-project")) ""))

(defmacro claude-code-ide-debug (format-string &rest args)
  "Log debug message with FORMAT-STRING and ARGS if debug is enabled.\nThis is a macro to avoid evaluating ARGS when debugging is disabled."
  (clel-seq (clel-concat (clojure-core-list 'clojure.core/when) (clojure-core-list 'user/claude-code-ide-debug) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'clojure.core/let) (clojure-core-list (apply clojure-core-vector (clel-seq (clel-concat (clojure-core-list 'user/message) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'clojure.core/format) (clojure-core-list format-string) args))) (clojure-core-list 'user/timestamp) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'user/format-time-string) (clojure-core-list "%Y-%m-%d %H:%M:%S")))) (clojure-core-list 'user/context) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'user/claude-code-ide-debug--get-session-context)))))))) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'user/with-current-buffer) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'user/get-buffer-create) (clojure-core-list 'user/claude-code-ide-debug-buffer)))) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'user/goto-char) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'user/point-max))))))) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'user/insert) (clojure-core-list (clel-seq (clel-concat (clojure-core-list 'clojure.core/format) (clojure-core-list "%s %s%s\n") (clojure-core-list 'user/timestamp) (clojure-core-list 'user/context) (clojure-core-list 'user/message))))))))))))))))

(defun claude-code-ide-debug-log (format-string &rest args)
  "Log message with FORMAT-STRING and ARGS."
  (let* ((message (apply #'format format-string args)))
    (message "%s %s" (claude-code-ide-debug--get-session-context) message)))

(defun claude-code-ide-debug-show-debug ()
  "Show the debug buffer."
  (interactive)
  (display-buffer (get-buffer-create claude-code-ide-debug-buffer)))

(defun claude-code-ide-debug-clear-debug ()
  "Clear the debug buffer."
  (interactive)
  (with-current-buffer (get-buffer-create claude-code-ide-debug-buffer)
    (erase-buffer)
    (message "Debug buffer cleared")))

(provide 'claude-code-ide-debug)
;;; claude-code-ide-debug.el ends here
